
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-secret
  namespace: gdd-service
spec:
  refreshInterval: 12h
  secretStoreRef:
    name: bitwarden
    kind: ClusterSecretStore
  data:
  - secretKey: ADMIN_USER
    remoteRef:
      key: "d4cb252b-a137-4267-87d7-b22c014bba1d"
  - secretKey: ADMIN_PASS
    remoteRef:
      key: "64c7b793-7a2d-4f5a-b6f2-b22c014bcf77"
  - secretKey: SMTP_USERNAME
    remoteRef:
      key: "f6a2fdeb-c77c-4a9e-bfa2-b386011b8b4e"
  - secretKey: SMTP_PASSWORD
    remoteRef:
      key: "b16b6872-56ea-4e5a-bb08-b386011ba773"
  - secretKey: SMTP_HOST
    remoteRef:
      key: "68ad51b8-32c9-474d-9dc2-b386011bc44f"
  - secretKey: SMTP_PORT
    remoteRef:
      key: "6cc48e5e-f704-4459-a671-b386011bdd86"
  - secretKey: OIDC_CLIENT_ID
    remoteRef:
      key: "a6788425-6d90-433c-9c8c-b392016c8cc1"
  - secretKey: OIDC_CLIENT_SECRET
    remoteRef:
      key: "68ba6f3d-5602-4c1f-8bf3-b392016caaa5"
  - secretKey: TOKEN
    remoteRef:
      key: "38460dc1-4ec8-4e67-a3c7-b392016d1920"
  - secretKey: POSTGRES_DB
    remoteRef:
      key: "9449ddea-4a17-4fb0-be8b-b392016d449b"
  - secretKey: POSTGRES_HOST
    remoteRef:
      key: "e478189e-a155-4dbe-adbd-b392016de319"
  - secretKey: POSTGRES_PASSWORD
    remoteRef:
      key: "b8728640-e567-4e37-9b55-b22c014b70d4"
  - secretKey: POSTGRES_USER
    remoteRef:
      key: "3b461b35-7c8b-4eff-a9cc-b22c014b5214"

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-data-local-volsync
spec:
  refreshInterval: 12h
  secretStoreRef:
    name: bitwarden
    kind: ClusterSecretStore
  data:
  - secretKey: VOLSYNC_LOCAL_RESTIC_PASSWORD
    remoteRef:
      key: "57657703-39e1-41a7-a226-b3860141f806"
  - secretKey: VOLSYNC_LOCAL_ACCESS_KEY_ID
    remoteRef:
      key: "072086ba-6674-4801-a2a7-b38601421aa1"
  - secretKey: VOLSYNC_LOCAL_BUCKET_ENDPOINT
    remoteRef:
      key: "be3c5c1a-1c6f-4e92-93e6-b38601422f4e"
  - secretKey: VOLSYNC_LOCAL_SECRET_ACCESS_KEY
    remoteRef:
      key: "25acb515-115c-435e-ad10-b3860142453b"
  target:
    template:
      engineVersion: v2
      data:
#        RESTIC_REPOSITORY: "{{ .RESTIC_REPOSITORY }}${NS}/${APP}"
        RESTIC_REPOSITORY: "{{ .VOLSYNC_LOCAL_BUCKET_ENDPOINT }}/volsync/${NS}/nextcloud-data"
        RESTIC_PASSWORD: "{{ .VOLSYNC_LOCAL_RESTIC_PASSWORD }}"
        AWS_ACCESS_KEY_ID: "{{ .VOLSYNC_LOCAL_ACCESS_KEY_ID }}"
        AWS_SECRET_ACCESS_KEY: "{{ .VOLSYNC_LOCAL_SECRET_ACCESS_KEY }}"
---
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: nextcloud-data-b2-volsync
spec:
  refreshInterval: 12h
  secretStoreRef:
    name: bitwarden
    kind: ClusterSecretStore
  data:
  - secretKey: VOLSYNC_B2_RESTIC_PASSWORD
    remoteRef:
      key: "ba58f8dc-b191-4224-90a3-b38601425ace"
  - secretKey: VOLSYNC_B2_ACCESS_KEY_ID
    remoteRef:
      key: "0d408eae-142c-4947-ba64-b38601426e3b"
  - secretKey: VOLSYNC_B2_BUCKET_ENDPOINT
    remoteRef:
      key: "4604a62e-9d1c-4655-99c2-b386014285af"
  - secretKey: VOLSYNC_B2_SECRET_ACCESS_KEY
    remoteRef:
      key: "11ce4859-90d2-4501-ac01-b3860142ab16"
  target:
    template:
      engineVersion: v2
      data:
#        RESTIC_REPOSITORY: "{{ .RESTIC_REPOSITORY }}${NS}/${APP}"
        RESTIC_REPOSITORY: "s3:https://{{ .VOLSYNC_B2_BUCKET_ENDPOINT }}/omni-talos-gdd/${NS}/nextcloud-data"
        RESTIC_PASSWORD: "{{ .VOLSYNC_B2_RESTIC_PASSWORD }}"
        AWS_ACCESS_KEY_ID: "{{ .VOLSYNC_B2_ACCESS_KEY_ID }}"
        AWS_SECRET_ACCESS_KEY: "{{ .VOLSYNC_B2_SECRET_ACCESS_KEY }}"